# Naj

![Naj Banner](assets/naj-banner.jpg)

**Naj** (/*≈ãÀ§aj î/ 'I/Me') helps you manage multiple Git identities (Work, Personal, Open Source) without messing up your local config or SSH keys.

It ensures that the correct email, signing key, and SSH command are used for every commit.

## üöÄ Features

* **üõ°Ô∏è Fail-Safe Security**: Uses "Blind Injection" to forcibly wipe global identity keys before applying a profile. If your profile lacks a key, Naj fails securely rather than falling back to your global `~/.gitconfig`.
* **‚ö° Ephemeral Execution**: Run commands like `naj work commit` without modifying any files on disk. Perfect for one-off fixes.
* **üíæ Persistent Switching**: Permanently bind a repository to an identity using Git's native `[include]` directive.
* **üõ†Ô∏è Zero Config Setup**: Automatically handles `clone` and `init` setup, applying the correct identity immediately.
* **üìÇ Portable Profiles**: Profiles are stored in `~/.config/naj/profiles/`, designed to be synced via a private Git repository.

## üì¶ Installation

### From Cargo

```bash
cargo install naj
```

### From Source

```bash
git clone https://github.com/dotinx/naj.git
cd naj
cargo install --path .
```

## üìñ Usage

```bash
naj [OPTIONS] [PROFILE_ID] [GIT_ARGS]...
```

### Arguments

* `[PROFILE_ID]`: The Profile ID to switch to (e.g., 'work', 'personal').
* `[GIT_ARGS]...`: Git arguments to execute immediately after switching (Exec mode).

### Options

* `-c, --create <NAME> <EMAIL> <ID>`: Create a new profile interactively or with arguments.
* `-l, --list`: List all available profiles.
* `-r, --remove <ID>`: Remove a profile by ID.
* `-f, --force`: Force switch strategy (Perform Hard Clean). This aggressively sanitizes `.git/config` before applying the profile.
* `--completion <SHELL>`: Generate shell completion script. Supported shells: `bash`, `elvish`, `fish`, `powershell`, `zsh`.
* `-h, --help`: Print help.
* `-V, --version`: Print version.

## üí° Examples

### 1. Management: Create & Remove Identities

```bash
# Syntax: naj -c <Name> <Email> <ProfileID>
naj -c "Alice Work" "alice@company.com" "work"
naj -c "Alice Hobby" "alice@gmail.com" "personal"

# List all profiles
naj -l

# Remove a profile
naj -r work
```

### 2. Setup New Projects

When you clone or init a repository, Naj automatically sets up the local config.

```bash
# Clones the repo and immediately binds it to the "work" profile
naj work clone git@github.com:company/backend.git

# Inside the repo, you can now just use standard git
cd backend
git config user.email # Output: alice@company.com
```

### 3. One-off Commands (Exec Mode)

Run a command with a specific identity *without* modifying the repository config.

```bash
# Temporarily commit as "personal" in a work repo (e.g., fixing a typo)
naj personal commit -m "Fix typo"

# Verification
naj personal config user.email
```

### 4. Switch Identity (Persistent)

Change the identity bound to an existing repository.

```bash
cd my-repo
naj work

# If the repo has "dirty" config (manually set user.name), force overwrite it:
naj work -f
```

### Shell Completion

```bash
# Enable zsh completion
source <(naj --completion zsh)
```

## ‚öôÔ∏è Configuration

Naj follows the XDG Base Directory specification.

* **Config File**: `~/.config/naj/naj.toml`
* **Profiles**: `~/.config/naj/profiles/*.gitconfig`

On the first run, Naj will automatically create these directories and a default configuration file.

### Environment Variables

* `NAJ_CONFIG_PATH`: Override the config directory (Useful for NixOS or testing).
* `NAJ_MOCKING=1`: Dry-run mode. Prints the constructed `git` command to stderr instead of executing it.

## üîí Security Design: Blind Injection

In **Exec Mode**, Naj does **not** read your local configuration to decide what to override. Instead, it aggressively injects empty values for sensitive keys before applying your profile.

**Example command generated by Naj:**

```bash
git \
  -c user.name="" \       # 1. Wipe potential leaks
  -c user.email="" \
  -c user.signingkey="" \
  -c commit.gpgsign=false \
  -c include.path=~/.config/naj/profiles/work.gitconfig \ # 2. Apply Profile
  commit ...

```

This ensures that if your "work" profile is missing a GPG key, Git will error out ("Secret key not available") rather than silently using your personal GPG key from `~/.gitconfig`.

## üì¶ Build Artifacts

Use a machine running Linux to build artifacts for all targets. [rustup](https://rustup.rs/), [cross](https://github.com/cross-rs/cross), and `podman/docker` are required.

Run [build.sh](./build.sh) to build artifacts for all targets.

## üìÑ License

[BSD 2-Clause License](./LICENSE)